const musicVideoTrigger=async()=>{switch(mvStage){case-1:break;case 0:changeImage(mvInfo),videoPlayer.destroy(),(videoPlayer=new Plyr("#videoPlayer",{controls:[],autoplay:!1,muted:!0,clickToPlay:!1})).once("ready",event=>{changeVideo(mvInfo)}),videoPlayer.once("ended",event=>{mvStage=0});break;case 3e3:mvInfo.keyword?videoPlayer.currentTime=mvInfo.keyword.includes("BOSS")?Math.floor(videoPlayer.duration/2)+10:20:mvInfo.video_id&&(videoPlayer.currentTime=mvInfo.time?mvInfo.time:20);break;case 6e3:changeImage(mvInfo),videoPlayer.play();break;case 7e3:videoPlayer.pause();break;case 12e3:document.getElementById("videoPlayer").style.display="block",document.getElementById("wrapper").style.backgroundImage="",document.getElementById("pid").innerHTML="vid="+mvVid,pidUrl="https://youtu.be/"+mvVid,fadeInImage("videoPlayer","","body"),videoPlayer.play()}mvStage>-1&&(mvStage+=mvInterval)};var mvInfo,mvStage=-1,mvInterval=500,mvTrigger=setInterval(musicVideoTrigger,mvInterval),mvVid="";const changeImage=async info=>{console.log("Change image to character "+info.character);var imageList=[];firebase.database().ref("images").once("value").then(function(charas){if(charas.val().forEach(chara=>{chara.name==info.character&&chara.images.forEach(image=>{imageList.push(image.path)})}),imageList.length>0){var imageURL="."+imageList[Math.floor(Math.random()*imageList.length)],vp;document.getElementById("videoPlayer").style.display="none",videoPlayer.poster=imageURL;var pidTemp=imageURL.split("/")[3].split("_")[0];document.getElementById("pid").innerHTML="pid="+pidTemp,pidUrl="https://www.pixiv.net/member_illust.php?mode=medium&illust_id="+pidTemp,fadeInImage("wrapper",imageURL,"body")}else{var cx="009797881502979873179:yxcz0y7drxo",a=info.character,url;fetch("https://www.googleapis.com/customsearch/v1/siterestrict?key="+googleAPI+"&cx="+cx+"&q="+a+"&searchType=image&imgSize=large&safe=medium").then(function(response){return response.json()}).then(function(data){console.log(data);var imageURL=data.items[Math.floor(Math.random()*data.items.length)].link,vp;document.getElementById("videoPlayer").style.display="none",videoPlayer.poster=imageURL,document.getElementById("pid").innerHTML="",pidUrl="",fadeInImage("wrapper",imageURL,"body")})}})},changeVideo=async info=>{var request;info.keyword?(console.log("Crawler Keyword: "+info.keyword),gapi.client.youtube.search.list({part:"snippet",type:"video",videoDuration:"any",q:info.keyword.replace("BOSS","")}).execute(async response=>{var randomIndex=0,videoId=response.result.items[0].id.videoId;console.log("Video title: "+response.result.items[0].snippet.title+", id: "+videoId),mvVid=videoId,videoPlayer.source={type:"video",sources:[{src:videoId,provider:"youtube"}]}})):info.video_id&&(console.log("Database Video ID: "+info.video_id),mvVid=info.video_id,videoPlayer.source={type:"video",sources:[{src:info.video_id,provider:"youtube"}]})};var pidUrl;pid.addEventListener("click",function(){window.open(pidUrl,"_blank")});var googleAPI="AIzaSyALDYJZ_19ORofWN3mcvTsMS23f8UVYCug",videoPlayer=new Plyr("#videoPlayer",{controls:[],autoplay:!1,muted:!0,clickToPlay:!1});videoPlayer.once("ready",event=>{videoPlayer.stop()});