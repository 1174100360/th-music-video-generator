var progressNow=0;!function(factory){"object"==typeof exports?module.exports=factory():"function"==typeof define&&define.amd?define(factory):window.Vudio=factory()}(function(){"use strict";var __default_option={effect:"waveform",accuracy:128,width:256,height:100,waveform:{maxHeight:80,minHeight:1,spacing:1,color:"#f00",shadowBlur:0,shadowColor:"#f00",fadeSide:!0,horizontalAlign:"center",verticalAlign:"middle",prettify:!0},lighting:{maxHeight:80,lineWidth:0,color:"#f00",shadowBlur:0,shadowColor:"#f00",fadeSide:!0,horizontalAlign:"center",verticalAlign:"middle"}};function Vudio(audioSource,canvasElement,option){if(-1===["[object HTMLAudioSource]","[object HTMLAudioElement]","[object MediaStream]"].indexOf(Object.prototype.toString.call(audioSource)))throw new TypeError("Invaild Audio Source");if("[object HTMLCanvasElement]"!==Object.prototype.toString.call(canvasElement))throw new TypeError("Invaild Canvas Element");this.audioSrc=audioSource,this.canvasEle=canvasElement,this.option=__mergeOption(__default_option,option),this.meta={},this.stat=0,this.freqByteData=null,this.__init()}function __mergeOption(){var __result={};return Array.prototype.forEach.call(arguments,function(argument){var __prop,__value;for(__prop in argument)Object.prototype.hasOwnProperty.call(argument,__prop)&&("[object Object]"===Object.prototype.toString.call(argument[__prop])?__result[__prop]=__mergeOption(__result[__prop],argument[__prop]):__result[__prop]=argument[__prop])}),__result}return Vudio.prototype={__init:function(){var audioContext=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),source="[object MediaStream]"!==Object.prototype.toString.call(this.audioSrc)?audioContext.createMediaElementSource(this.audioSrc):audioContext.createMediaStreamSource(this.audioSrc),dpr=window.devicePixelRatio||1;this.analyser=audioContext.createAnalyser(),this.meta.spr=audioContext.sampleRate,source.connect(this.analyser),this.analyser.fftSize=2*this.option.accuracy,this.analyser.connect(audioContext.destination),this.freqByteData=new Uint8Array(this.analyser.frequencyBinCount),this.context2d=this.canvasEle.getContext("2d"),this.width=this.option.width,this.height=this.option.height,this.context2d.canvas.width=this.width*dpr,this.context2d.canvas.height=this.height*dpr,this.context2d.scale(dpr,dpr)},__rebuildData:function(freqByteData,horizontalAlign){var __freqByteData;return __freqByteData="center"===horizontalAlign?[].concat(Array.from(freqByteData).reverse().splice(this.option.accuracy/2,this.option.accuracy/2),Array.from(freqByteData).splice(0,this.option.accuracy/2)):"left"===horizontalAlign?freqByteData:"right"===horizontalAlign?Array.from(freqByteData).reverse():[].concat(Array.from(freqByteData).reverse().splice(this.option.accuracy/2,this.option.accuracy/2),Array.from(freqByteData).splice(0,this.option.accuracy/2))},__animate:function(){1===this.stat&&(this.analyser.getByteFrequencyData(this.freqByteData),"function"==typeof this.__effects()[this.option.effect]&&this.__effects()[this.option.effect](this.freqByteData),requestAnimationFrame(this.__animate.bind(this)))},__testFrame:function(){this.analyser.getByteFrequencyData(this.freqByteData),"function"==typeof this.__effects()[this.option.effect]&&this.__effects()[this.option.effect](this.freqByteData)},__effects:function(){var __that=this;return{lighting:function(freqByteData){var __lightingOption=__that.option.lighting,__freqByteData=__that.__rebuildData(freqByteData,__lightingOption.horizontalAlign),__maxHeight=__lightingOption.maxHeight/2,__isStart=!0,__fadeSide=!0,__x,__y;"center"!==__lightingOption.horizontalAlign&&(__fadeSide=!1),__that.context2d.clearRect(0,0,__that.width,__that.height),__that.context2d.lineWidth=__lightingOption.lineWidth,__that.context2d.strokeStyle=__lightingOption.color,__that.context2d.beginPath(),__freqByteData.forEach(function(value,index){__x=__that.width/__that.option.accuracy*index,__y=value/256*__maxHeight,__y="middle"===__lightingOption.verticalAlign?(__that.height-value)/2-__maxHeight/2:"bottom"===__lightingOption.verticalAlign?__that.height-value:"top"===__lightingOption.verticalAlign?value:(__that.height-value)/2-__maxHeight/2,__isStart?(__that.context2d.moveTo(__x,__y),__isStart=!1):__that.context2d.lineTo(__x,__y)}),__that.context2d.stroke()},waveform:function(freqByteData){var __waveformOption=__that.option.waveform,__fadeSide=__waveformOption.fadeSide,__prettify=__waveformOption.prettify,__freqByteData=__that.__rebuildData(freqByteData,__waveformOption.horizontalAlign),__maxHeight,__width,__height,__left,__top,__color,__linearGradient,__pos;"center"!==__waveformOption.horizontalAlign&&(__fadeSide=!1,__prettify=!1),__that.context2d.clearRect(0,0,__that.width,__that.height);var reflection=.2;__freqByteData.forEach(function(value,index){if(__width=(__that.width-__that.option.accuracy*__waveformOption.spacing)/__that.option.accuracy,__left=index*(__width+__waveformOption.spacing),1!==__waveformOption.spacing&&(__left+=__waveformOption.spacing/2),__maxHeight=__prettify?index<=__that.option.accuracy/2?(1-(__that.option.accuracy/2-1-index)/(__that.option.accuracy/2))*__waveformOption.maxHeight:(1-(index-__that.option.accuracy/2)/(__that.option.accuracy/2))*__waveformOption.maxHeight:__waveformOption.maxHeight,__height=(__height=value/256*__maxHeight*.8)<__waveformOption.minHeight?__waveformOption.minHeight:__height,__top="middle"===__waveformOption.verticalAlign?(__that.height-__height)/2:"top"===__waveformOption.verticalAlign?0:"bottom"===__waveformOption.verticalAlign?.8*__that.height-__height:(__that.height-__height)/2,__color=__waveformOption.color,index<=Math.floor(__freqByteData.length*progressNow)){__linearGradient=__that.context2d.createLinearGradient(__left,__top,__left,__top+__height);var color_temp=["#c477ff","#bf6dff"," #b556ff"];color_temp.forEach(function(color,index){__pos=0===index||index===color_temp.length-1?index/(color_temp.length-1):index/color_temp.length+.5/color_temp.length,__linearGradient.addColorStop(__pos,color)}),__that.context2d.fillStyle=__linearGradient}else __color instanceof Array?(__linearGradient=__that.context2d.createLinearGradient(__left,__top,__left,__top+__height),__color.forEach(function(color,index){color instanceof Array?(__pos=color[0],color=color[1]):__pos=0===index||index===__color.length-1?index/(__color.length-1):index/__color.length+.5/__color.length,__linearGradient.addColorStop(__pos,color)}),__that.context2d.fillStyle=__linearGradient):__that.context2d.fillStyle=__color;__waveformOption.shadowBlur>0&&(__that.context2d.shadowBlur=__waveformOption.shadowBlur,__that.context2d.shadowColor=__waveformOption.shadowColor),__fadeSide?index<=__that.option.accuracy/2?__that.context2d.globalAlpha=1-(__that.option.accuracy/2-1-index)/(__that.option.accuracy/2):__that.context2d.globalAlpha=1-(index-__that.option.accuracy/2)/(__that.option.accuracy/2):__that.context2d.globalAlpha=1,__that.context2d.fillRect(__left,__top,__width,__height)}),__freqByteData.forEach(function(value,index){if(__width=(__that.width-__that.option.accuracy*__waveformOption.spacing)/__that.option.accuracy,__left=index*(__width+__waveformOption.spacing),1!==__waveformOption.spacing&&(__left+=__waveformOption.spacing/2),__maxHeight=__prettify?index<=__that.option.accuracy/2?(1-(__that.option.accuracy/2-1-index)/(__that.option.accuracy/2))*__waveformOption.maxHeight:(1-(index-__that.option.accuracy/2)/(__that.option.accuracy/2))*__waveformOption.maxHeight:__waveformOption.maxHeight,__height=(__height=value/256*__maxHeight*.2)<__waveformOption.minHeight?__waveformOption.minHeight:__height,__top=.8*__that.height,__color=__waveformOption.color,index<=Math.floor(__freqByteData.length*progressNow)){__linearGradient=__that.context2d.createLinearGradient(__left,__top,__left,__top+__height);var color_temp=["#c477ff","#bf6dff"," #b556ff"];color_temp.forEach(function(color,index){__pos=0===index||index===color_temp.length-1?index/(color_temp.length-1):index/color_temp.length+.5/color_temp.length,__linearGradient.addColorStop(__pos,color)}),__that.context2d.fillStyle=__linearGradient}else __color instanceof Array?(__linearGradient=__that.context2d.createLinearGradient(__left,__top,__left,__top+__height),__color.forEach(function(color,index){color instanceof Array?(__pos=color[0],color=color[1]):__pos=0===index||index===__color.length-1?index/(__color.length-1):index/__color.length+.5/__color.length,__linearGradient.addColorStop(__pos,color)}),__that.context2d.fillStyle=__linearGradient):__that.context2d.fillStyle=__color;__waveformOption.shadowBlur>0&&(__that.context2d.shadowBlur=__waveformOption.shadowBlur,__that.context2d.shadowColor=__waveformOption.shadowColor),__fadeSide?index<=__that.option.accuracy/2?__that.context2d.globalAlpha=1-(__that.option.accuracy/2-1-index)/(__that.option.accuracy/2):__that.context2d.globalAlpha=1-(index-__that.option.accuracy/2)/(__that.option.accuracy/2):__that.context2d.globalAlpha=1,__that.context2d.globalAlpha=.2,__that.context2d.fillRect(__left,__top,__width,__height)})}}},dance:function(){return 0===this.stat&&(this.stat=1,this.__animate()),this},pause:function(){return this.stat=0,this},setOption:function(option){this.option=__mergeOption(this.option,option)}},Vudio});const delay=ms=>new Promise(resolve=>{setTimeout(resolve,ms)});function setOpacity(object,opacityPct){object.style.opacity=opacityPct/100}function changeOpacity(id,msDuration,msStart,fromO,toO){var object=document.getElementById(id),opacity=100*object.style.opacity,msNow;(opacity=fromO+(toO-fromO)*((new Date).getTime()-msStart)/msDuration)<0?setOpacity(object,0):opacity>100?setOpacity(object,100):(setOpacity(object,opacity),object.timer=window.setTimeout("changeOpacity('"+id+"',"+msDuration+","+msStart+","+fromO+","+toO+")",1))}function imagePreload(src){if(document.images)return img=new Image,img.src=src,img}function fadeInImage(foregroundId,imageURL,backgroundId){imageURL&&imagePreload(imageURL);var foreground=document.getElementById(foregroundId),background=document.getElementById(backgroundId);background&&(background.style.backgroundImage=foreground.style.backgroundImage,background.style.backgroundRepeat="no-repeat"),setOpacity(foreground,0),foreground.style.backgroundImage="url('"+imageURL+"')",foreground.timer&&window.clearTimeout(foreground.timer);var startMS=(new Date).getTime();foreground.timer=window.setTimeout("changeOpacity('"+foregroundId+"',1000,"+startMS+",0,100)",10)}window.mobilecheck=function(){var check=!1,a;return a=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(check=!0),check};var elms=["track","timer","duration","playBtn","pauseBtn","prevBtn","nextBtn","settingBtn","playlistBtn","volumeBtn","progress","waveform","canvas","loading","playlist","list","volume","barEmpty","barFull","sliderBtn"];elms.forEach(function(elm){window[elm]=document.getElementById(elm)});var Player=function(playlist){this.playlist=playlist;do{this.index=Math.floor(Math.random()*playlist.length)}while(null==playlist[this.index].file);track.innerHTML=playlist[this.index].title;for(var indexTemp=this.index-1;null!=this.playlist[indexTemp].file;)--indexTemp;document.getElementById("series").innerHTML=this.playlist[indexTemp].title,changeImage(playlist[this.index].info);var ul=null,ulth=1,pl=document.getElementById("playlist");playlist.forEach(function(song){var li=document.createElement("li");if(li.className="pure-menu-item",null==song.file)null!=ul&&pl.appendChild(ul),li.innerHTML=song.title,li.className+=" pure-menu-disabled playlist-title",(ul=document.createElement("ul")).className="pure-menu-list",ulth>5&&(ul.style.backgroundImage="url('./images/title/"+("00"+ulth).slice(-2)+".jpg')"),ulth++;else{var a=document.createElement("div");a.innerHTML=song.title,a.className="pure-menu-link playlist-item",a.onclick=function(){player.skipTo(playlist.indexOf(song))},li.appendChild(a)}ul.appendChild(li)}),pl.appendChild(ul),gapi.client.setApiKey(googleAPI),gapi.client.load("youtube","v3")};Player.prototype={play:function(index,isNewSong){var self=this,sound;index="number"==typeof index?index:self.index,self.playlist[self.index].howl&&self.index!=index&&(self.playlist[self.index].howl.unload(),delete self.playlist[self.index].howl),self.index=index,console.log("Playing index "+index);var data=self.playlist[index];if(null!=data.file){if(data.howl)sound=data.howl;else{sound=data.howl=new Howl({src:["."+data.file],html5:!0,onplay:function(){duration.innerHTML=self.formatTime(Math.round(sound.duration())),requestAnimationFrame(self.step.bind(self)),pauseBtn.style.display="block"},onload:function(){loading.style.display="none"},onend:function(){self.skip("next")},onpause:function(){},onstop:function(){}});var width=waveform.clientWidth,height=window.innerHeight>0?.2*window.innerHeight:.2*screen.height;if(waveform.style.bottom=.1*height+90+"px",mobilecheck())canvas.style.display="none",waveform.style.opacity=1,wavesurfer&&wavesurfer.destroy(),(wavesurfer=WaveSurfer.create({container:"#waveform",backend:"MediaElement",barWidth:3,cursorColor:"#b556ff",cursorWidth:1,progressColor:"#bf6dff",waveColor:"#e0e0e0"})).load(sound._sounds[0]._node),wavesurfer.on("ready",function(){wavesurfer.play()});else{var accuracy=width<400?16:width<550?32:width<950?64:128;canvas.style.display="block",waveform.style.opacity=.5,wavesurfer&&wavesurfer.destroy(),(vudio=new Vudio(sound._sounds[0]._node,canvas,{effect:"waveform",accuracy:accuracy,width:width,height:height,waveform:{maxHeight:height/10*9,minHeight:1,spacing:4,color:["#ffffff","#e0e0e0"," #c9c9c9"],shadowBlur:1,shadowColor:"#939393",fadeSide:!1,prettify:!1,horizontalAlign:"center",verticalAlign:"bottom"}})).dance()}waveform.style.cursor="pointer";for(var indexTemp=index-1;null!=self.playlist[indexTemp].file;)--indexTemp;document.getElementById("series").innerHTML=self.playlist[indexTemp].title}sound.play(),track.innerHTML=data.title,videoPlayer.stopped||isNewSong?(mvInfo=data.info,mvStage=0):videoPlayer.paused&&videoPlayer.play(),"loaded"===sound.state()?(playBtn.style.display="none",pauseBtn.style.display="block"):(loading.style.display="block",playBtn.style.display="none",pauseBtn.style.display="none")}else self.skip("next")},pause:function(){var self=this,sound;this.playlist[this.index].howl.pause(),videoPlayer.playing&&videoPlayer.pause(),playBtn.style.display="block",pauseBtn.style.display="none"},skip:function(direction){var self=this,index=0;randomPlay.checked?index=Math.floor(Math.random()*this.playlist.length):"prev"===direction?(index=this.index-1)<0&&(index=this.playlist.length-1):(index=this.index+1)>=this.playlist.length&&(index=0),this.skipTo(index)},skipTo:function(index){var self=this;this.playlist[this.index].howl&&this.playlist[this.index].howl.stop(),progress.style.width="0%",progressNow=0,this.play(index,!0)},volume:function(val){var self=this;Howler.volume(val);var barWidth=90*val/100;barFull.style.width=100*barWidth+"%",sliderBtn.style.left=window.innerWidth*barWidth+.05*window.innerWidth-25+"px"},seek:function(per){var self=this,sound=this.playlist[this.index].howl;sound.seek(sound.duration()*per)},step:function(){var self=this,sound=this.playlist[this.index].howl,seek=sound.seek()||0;timer.innerHTML=this.formatTime(Math.round(seek)),progressNow=seek/sound.duration(),progress.style.width=(100*progressNow||0)+"%",requestAnimationFrame(this.step.bind(this))},togglePlaylist:function(){var self=this,display="block"===playlist.style.display?"none":"block";setTimeout(function(){playlist.style.display=display},"block"===display?0:500),playlist.className="block"===display?"pure-menu pure-menu-scrollable fadein":"pure-menu pure-menu-scrollable fadeout"},toggleVolume:function(){var self=this,display="block"===volume.style.display?"none":"block";setTimeout(function(){volume.style.display=display},"block"===display?0:500),volume.className="block"===display?"fadein":"fadeout"},toggleSetting:function(){var self=this,display="block"===setting.style.display?"none":"block";setTimeout(function(){setting.style.display=display},"block"===display?0:500),setting.className="block"===display?"pure-menu fadein":"pure-menu fadeout"},formatTime:function(secs){var minutes=Math.floor(secs/60)||0,seconds=secs-60*minutes||0;return minutes+":"+(seconds<10?"0":"")+seconds}};var songList=[],player,vudio,wavesurfer,resize=function(){var width=waveform.clientWidth,height=window.innerHeight>0?.2*window.innerHeight:.2*screen.height;waveform.style.bottom=.1*height+90+"px",canvas.width=width,canvas.height=height;var sound=player.playlist[player.index].howl;if(sound){var vol,barWidth=.9*sound.volume();sliderBtn.style.left=window.innerWidth*barWidth+.05*window.innerWidth-25+"px",vudio.width=width,vudio.height=height;var space=Math.floor(Math.abs(width-500)/300)+2,accuracy=width<550?32:width<1e3?64:128;vudio.setOption({accuracy:accuracy,waveform:{maxHeight:height/10*9}})}};window.addEventListener("resize",resize);var move=function(event){if(window.sliderDown){var x,startX,layerX=(event.clientX||event.touches[0].clientX)-.05*window.innerWidth,per=Math.min(1,Math.max(0,layerX/parseFloat(barEmpty.scrollWidth)));player.volume(per)}};volume.addEventListener("mousemove",move),volume.addEventListener("touchmove",move),firebase.database().ref("games").once("value").then(function(games){games.val().forEach(game=>{var songObj={};songObj.title=game.name,songObj.file=null,songList.push(songObj),game.songs.forEach(song=>{var songObj={};songObj.title=song.name.split(".")[1]," U"==songObj.title&&(songObj.title=" U.N.オーエンは彼女なのか？"),songObj.file=song.path,songObj.howl=null,songObj.info=song,songList.push(songObj)})}),player=new Player(songList),resize()}),playBtn.addEventListener("click",function(){player.play()}),pauseBtn.addEventListener("click",function(){player.pause()}),prevBtn.addEventListener("click",function(){player.skip("prev")}),nextBtn.addEventListener("click",function(){player.skip("next")}),waveform.addEventListener("click",function(event){player.seek(event.clientX/window.innerWidth)}),playlistBtn.addEventListener("click",function(){player.togglePlaylist()}),playlist.addEventListener("click",function(){player.togglePlaylist()}),volumeBtn.addEventListener("click",function(){player.toggleVolume()}),volume.addEventListener("click",function(){player.toggleVolume()}),closePlaylist.addEventListener("click",function(){player.togglePlaylist()}),settingBtn.addEventListener("click",function(){player.toggleSetting()}),barEmpty.addEventListener("click",function(event){var per=event.layerX/parseFloat(barEmpty.scrollWidth);player.volume(per)}),sliderBtn.addEventListener("mousedown",function(){window.sliderDown=!0}),sliderBtn.addEventListener("touchstart",function(){window.sliderDown=!0}),volume.addEventListener("mouseup",function(){window.sliderDown=!1}),volume.addEventListener("touchend",function(){window.sliderDown=!1});for(var i=6;i<27;i++)imagePreload("./images/title/"+("00"+i).slice(-2)+".jpg");const musicVideoTrigger=async()=>{switch(mvStage){case-1:break;case 0:changeImage(mvInfo),mvNumOfImages=numOfImagesValue-1,videoPlayer.destroy(),(videoPlayer=new Plyr("#videoPlayer",{controls:[],autoplay:!1,muted:!0,clickToPlay:!1})).once("ready",event=>{changeVideo(mvInfo)}),videoPlayer.once("ended",event=>{mvStage=0});break;case 2e3:mvInfo.keyword?videoPlayer.currentTime=mvInfo.keyword.includes("BOSS")?Math.floor(videoPlayer.duration/2)+10:20:mvInfo.video_id&&(videoPlayer.currentTime=mvInfo.time?mvInfo.time:20);break;case 1e3*imagesDurationValue*(numOfImagesValue-mvNumOfImages):console.log(1e3*imagesDurationValue*(numOfImagesValue-mvNumOfImages)+", left "+mvNumOfImages),imagesDurationValue*(numOfImagesValue-mvNumOfImages)==6&&imagesDurationValue*numOfImagesValue>6&&(console.log("6000play"),videoPlayer.play()),mvNumOfImages>0?(changeImage(mvInfo),mvNumOfImages--):0==mvNumOfImages&&(document.getElementById("videoPlayer").style.display="block",document.getElementById("wrapper").style.backgroundImage="",document.getElementById("pid").innerHTML="vid="+mvVid,pidUrl="https://youtu.be/"+mvVid,mvNumOfImages=numOfImagesValue-1,fadeInImage("videoPlayer","","body"),videoPlayer.play());break;case 6e3:imagesDurationValue*numOfImagesValue>6&&(console.log("6000play"),videoPlayer.play());break;case 7e3:imagesDurationValue*numOfImagesValue>7&&(console.log("7000pause"),videoPlayer.pause())}mvStage>-1&&(mvStage+=mvInterval)};var mvInfo,mvStage=-1,mvInterval=500,mvTrigger=setInterval(musicVideoTrigger,mvInterval),mvVid="",mvNumOfImages=numOfImages?parseInt(numOfImages.value)-1:1;const changeImage=async info=>{console.log("Change image to character "+info.character);var imageList=[];firebase.database().ref("images").once("value").then(function(charas){if(charas.val().forEach(chara=>{chara.name==info.character&&chara.images.forEach(image=>{imageList.push(image.path)})}),imageList.length>0){var imageURL="."+imageList[Math.floor(Math.random()*imageList.length)],vp;document.getElementById("videoPlayer").style.display="none",videoPlayer.poster=imageURL;var pidTemp=imageURL.split("/")[3].split("_")[0];document.getElementById("pid").innerHTML="pid="+pidTemp,pidUrl="https://www.pixiv.net/member_illust.php?mode=medium&illust_id="+pidTemp,fadeInImage("wrapper",imageURL,"body")}else{var cx="009797881502979873179:yxcz0y7drxo",a=info.character,url;fetch("https://www.googleapis.com/customsearch/v1/siterestrict?key="+googleAPI+"&cx="+cx+"&q="+a+"&searchType=image&imgSize=large&safe=medium").then(function(response){return response.json()}).then(function(data){console.log(data);var imageURL=data.items[Math.floor(Math.random()*data.items.length)].link,vp;document.getElementById("videoPlayer").style.display="none",videoPlayer.poster=imageURL,document.getElementById("pid").innerHTML="",pidUrl="",fadeInImage("wrapper",imageURL,"body")})}})},changeVideo=async info=>{var request;info.keyword?(console.log("Crawler Keyword: "+info.keyword),gapi.client.youtube.search.list({part:"snippet",type:"video",videoDuration:"any",q:info.keyword.replace("BOSS","")}).execute(async response=>{var randomIndex=0,videoId=response.result.items[0].id.videoId;console.log("Video title: "+response.result.items[0].snippet.title+", id: "+videoId),mvVid=videoId,videoPlayer.source={type:"video",sources:[{src:videoId,provider:"youtube"}]}})):info.video_id&&(console.log("Database Video ID: "+info.video_id),mvVid=info.video_id,videoPlayer.source={type:"video",sources:[{src:info.video_id,provider:"youtube"}]})};var pidUrl,numOfImagesValue=numOfImages?parseInt(numOfImages.value):2,imagesDurationValue=imagesDuration?parseInt(imagesDuration.value):6;pid.addEventListener("click",function(){window.open(pidUrl,"_blank")}),numOfImages.addEventListener("change",function(){numOfImagesValue=parseInt(numOfImages.value),mvStage=0}),imagesDuration.addEventListener("change",function(){imagesDurationValue=parseInt(imagesDuration.value),mvStage=0});var googleAPI="AIzaSyALDYJZ_19ORofWN3mcvTsMS23f8UVYCug",videoPlayer=new Plyr("#videoPlayer",{controls:[],autoplay:!1,muted:!0,clickToPlay:!1});videoPlayer.once("ready",event=>{videoPlayer.stop()});